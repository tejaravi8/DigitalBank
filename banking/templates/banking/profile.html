<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digital Bank | Profile</title>
<link rel="icon" type="image/x-icon" href="https://img.icons8.com/color/96/bank-building.png">


<style>
/* -------------------- GLOBAL -------------------- */
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: #F3F4F6;
    display: flex;
    height: 100vh;
    overflow: hidden;
}

h1, h2, h3, h4, p { margin: 0; }

/* -------------------- SIDEBAR -------------------- */
.sidebar {
    width: 250px;
    background: #1E3A8A;
    color: white;
    padding: 30px 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.brand-box {
    text-align: center;
    margin-bottom: 40px;
}

.brand-logo {
    width: 70px;
    margin-bottom: 10px;
}

.brand-title {
    font-size: 23px;
    font-weight: bold;
}

.nav-links a {
    display: block;
    color: #DCE3FF;
    text-decoration: none;
    padding: 12px 14px;
    margin: 5px 0;
    border-radius: 8px;
    font-size: 16px;
}

.nav-links a:hover {
    background: rgba(255,255,255,0.15);
    color: white;
}

.user-box {
    padding: 20px 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    text-align: center;
}

.user-name {
    font-size: 16px;
    font-weight: 600;
}

/* -------------------- MAIN -------------------- */
.main {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
}

.top-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.top-header h1 {
    font-size: 28px;
    color: #1E293B;
}

/* -------------------- BUTTON -------------------- */
.edit-btn {
    padding: 10px 18px;
    background: #1E3A8A;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
}
.edit-btn:hover {
    background: #17347A;
}

/* -------------------- PROFILE CARD -------------------- */
.profile-box {
    background: white;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.05);
    margin-bottom: 30px;
}

.profile-row {
    background: #F8FAFC;
    padding: 15px 20px;
    border-radius: 12px;
    margin-top: 12px;
}

/* -------------------- EDIT FORM -------------------- */
.edit-form {
    display: none;
    margin-top: 20px;
}

.edit-form input {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border-radius: 10px;
    border: 1px solid #CBD5E1;
    font-size: 15px;
}

.save-btn {
    margin-top: 16px;
    padding: 12px 20px;
    background: #10B981;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
}
.save-btn:hover {
    background: #059669;
}

/* -------------------- ACCOUNT BOX -------------------- */
.account-box {
    background: white;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.05);
}

.acc-row {
    background: #F8FAFC;
    padding: 15px 20px;
    border-radius: 12px;
    margin-top: 12px;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <div>
        <div class="brand-box">
            <img src="https://img.icons8.com/color/96/bank-building.png" class="brand-logo">
            <div class="brand-title">Digital Bank</div>
        </div>

        <div class="nav-links">
            <a href="/dashboard/">üè† Dashboard</a>
            <a href="/api/profile/">üë§ Profile</a>
            <a href="/api/transfers/">üí∏ Money Transfers</a>
            <a href="/api/settings/">‚öô Settings</a>
        </div>
    </div>

    <div class="user-box">
        <div class="user-name" id="username">Loading...</div>
        <small>Logged in user</small>
    </div>
</div>

<!-- MAIN -->
<div class="main">

    <div class="top-header">
        <h1>Profile Overview</h1>
        <button class="edit-btn" onclick="toggleEdit()">Edit Profile</button>
    </div>

    <!-- PROFILE DETAILS -->
    <div class="profile-box">
        <h2>Personal Information</h2>

        <div class="profile-row"><strong>Full Name:</strong> <span id="fullName"></span></div>
        <div class="profile-row"><strong>Username:</strong> <span id="uName"></span></div>
        <div class="profile-row"><strong>Email:</strong> <span id="email"></span></div>
        <div class="profile-row"><strong>Phone:</strong> <span id="phone"></span></div>
        <div class="profile-row"><strong>Address:</strong> <span id="address"></span></div>
        <div class="profile-row"><strong>KYC Status:</strong> <span id="kyc"></span></div>

        <!-- EDIT FORM -->
        <div class="edit-form" id="editForm">
            <input id="firstName" placeholder="First Name">
            <input id="lastName" placeholder="Last Name">
            <input id="emailInput" placeholder="Email">
            <input id="phoneInput" placeholder="Phone Number">
            <input id="addressInput" placeholder="Address">
            <button class="save-btn" onclick="saveProfile()">Save Changes</button>
        </div>
    </div>

    <!-- ACCOUNTS -->
    <div class="account-box">
        <h2>Your Accounts</h2>
        <div id="accountsList"></div>
    </div>

</div>

<script>
let profileData = null;

async function loadProfile() {
    const token = localStorage.getItem("token");

    const res = await fetch("/api/auth/me/", {
        headers: { "Authorization": "Token " + token }
    });

    if (!res.ok) {
        window.location.href = "/";
        return;
    }

    const data = await res.json();
    profileData = data;

    username.innerText = data.username;
    fullName.innerText = `${data.first_name} ${data.last_name}`;
    uName.innerText = data.username;
    email.innerText = data.email;

    phone.innerText = data.profile.phone_number;
    address.innerText = data.profile.address || "Not provided";
    kyc.innerText = data.profile.kyc_status;

    firstName.value = data.first_name;
    lastName.value = data.last_name;
    emailInput.value = data.email;
    phoneInput.value = data.profile.phone_number;
    addressInput.value = data.profile.address || "";

    accountsList.innerHTML = "";
data.accounts.forEach(acc => {
    accountsList.innerHTML += `
        <div class="acc-row">
            <strong>${acc.account_type}</strong><br>
            Account No: ${acc.account_number}<br>
            Branch: ${acc.branch_name}<br>
            IFSC: ${acc.ifsc_code}<br>
            Balance: ‚Çπ${acc.balance}<br>
            Created: ${acc.created_at.slice(0, 10)}
        </div>
    `;
});

}

function toggleEdit() {
    const form = document.getElementById("editForm");
    form.style.display = form.style.display === "block" ? "none" : "block";
}

async function saveProfile() {
    const token = localStorage.getItem("token");

    const res = await fetch("/api/profile/update/", {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Token " + token
        },
        body: JSON.stringify({
            first_name: firstName.value,
            last_name: lastName.value,
            email: emailInput.value,
            phone_number: phoneInput.value,
            address: addressInput.value
        })
    });

    if (res.ok) {
        alert("Profile updated successfully");
        toggleEdit();
        loadProfile();
    } else {
        alert("Update failed");
    }
}

loadProfile();
</script>

</body>
</html>
